/**
 *  SOUNDS - SISTEMA DE AUDIO Y EFECTOS SONOROS
 * Gesti贸n completa de sonidos y notificaciones auditivas
 */

// ============================================
//  EFECTOS DE ACCIONES
// ============================================

export const ACTION_SOUNDS = {
  BUTTON_CLICK: '/assets/sounds/actions/button-click.mp3',
  BUTTON_HOVER: '/assets/sounds/actions/button-hover.mp3',
  SUCCESS: '/assets/sounds/actions/success.mp3',
  ERROR: '/assets/sounds/actions/error.mp3',
  WARNING: '/assets/sounds/actions/warning.mp3',
  INFO: '/assets/sounds/actions/info.mp3',
  SAVE: '/assets/sounds/actions/save.mp3',
  DELETE: '/assets/sounds/actions/delete.mp3',
  ADD: '/assets/sounds/actions/add.mp3',
  EDIT: '/assets/sounds/actions/edit.mp3',
  CANCEL: '/assets/sounds/actions/cancel.mp3',
  REFRESH: '/assets/sounds/actions/refresh.mp3',
  SEARCH: '/assets/sounds/actions/search.mp3',
  FILTER: '/assets/sounds/actions/filter.mp3',
  SORT: '/assets/sounds/actions/sort.mp3',
};

// ============================================
//  NOTIFICACIONES
// ============================================

export const NOTIFICATION_SOUNDS = {
  REMINDER: '/assets/sounds/notifications/reminder.mp3',
  ALARM: '/assets/sounds/notifications/alarm.mp3',
  MESSAGE: '/assets/sounds/notifications/message.mp3',
  EMAIL: '/assets/sounds/notifications/email.mp3',
  CALENDAR: '/assets/sounds/notifications/calendar.mp3',
  TASK: '/assets/sounds/notifications/task.mp3',
  GOAL: '/assets/sounds/notifications/goal.mp3',
  ACHIEVEMENT: '/assets/sounds/notifications/achievement.mp3',
  BIRTHDAY: '/assets/sounds/notifications/birthday.mp3',
  EVENT: '/assets/sounds/notifications/event.mp3',
  MEETING: '/assets/sounds/notifications/meeting.mp3',
};

// ============================================
//  SONIDOS DE NAVEGACIN
// ============================================

export const NAVIGATION_SOUNDS = {
  PAGE_ENTER: '/assets/sounds/navigation/page-enter.mp3',
  PAGE_EXIT: '/assets/sounds/navigation/page-exit.mp3',
  MENU_OPEN: '/assets/sounds/navigation/menu-open.mp3',
  MENU_CLOSE: '/assets/sounds/navigation/menu-close.mp3',
  TAB_SWITCH: '/assets/sounds/navigation/tab-switch.mp3',
  BACK: '/assets/sounds/navigation/back.mp3',
  FORWARD: '/assets/sounds/navigation/forward.mp3',
  HOME: '/assets/sounds/navigation/home.mp3',
  SETTINGS: '/assets/sounds/navigation/settings.mp3',
};

// ============================================
//  SONIDOS DE SALUD Y FITNESS
// ============================================

export const HEALTH_SOUNDS = {
  WORKOUT_START: '/assets/sounds/health/workout-start.mp3',
  WORKOUT_END: '/assets/sounds/health/workout-end.mp3',
  REST_BREAK: '/assets/sounds/health/rest-break.mp3',
  WATER_REMINDER: '/assets/sounds/health/water-reminder.mp3',
  MEAL_TIME: '/assets/sounds/health/meal-time.mp3',
  SLEEP_REMINDER: '/assets/sounds/health/sleep-reminder.mp3',
  STRETCHING: '/assets/sounds/health/stretching.mp3',
  MEDITATION: '/assets/sounds/health/meditation.mp3',
  BREATHING: '/assets/sounds/health/breathing.mp3',
  HEART_RATE: '/assets/sounds/health/heart-rate.mp3',
};

// ============================================
//  SONIDOS EDUCATIVOS
// ============================================

export const EDUCATION_SOUNDS = {
  STUDY_START: '/assets/sounds/education/study-start.mp3',
  BREAK_TIME: '/assets/sounds/education/break-time.mp3',
  TEST_START: '/assets/sounds/education/test-start.mp3',
  GRADE_RECEIVED: '/assets/sounds/education/grade-received.mp3',
  HOMEWORK_DONE: '/assets/sounds/education/homework-done.mp3',
  CLASS_START: '/assets/sounds/education/class-start.mp3',
  CLASS_END: '/assets/sounds/education/class-end.mp3',
  READING_TIME: '/assets/sounds/education/reading-time.mp3',
  QUIZ_CORRECT: '/assets/sounds/education/quiz-correct.mp3',
  QUIZ_INCORRECT: '/assets/sounds/education/quiz-incorrect.mp3',
};

// ============================================
//  SONIDOS DE LOGROS Y MOTIVACIN
// ============================================

export const ACHIEVEMENT_SOUNDS = {
  LEVEL_UP: '/assets/sounds/achievements/level-up.mp3',
  STREAK_BROKEN: '/assets/sounds/achievements/streak-broken.mp3',
  STREAK_MAINTAINED: '/assets/sounds/achievements/streak-maintained.mp3',
  GOAL_REACHED: '/assets/sounds/achievements/goal-reached.mp3',
  MILESTONE: '/assets/sounds/achievements/milestone.mp3',
  BADGE_EARNED: '/assets/sounds/achievements/badge-earned.mp3',
  RECORD_BROKEN: '/assets/sounds/achievements/record-broken.mp3',
  PERFECT_SCORE: '/assets/sounds/achievements/perfect-score.mp3',
  FIRST_TIME: '/assets/sounds/achievements/first-time.mp3',
  IMPROVEMENT: '/assets/sounds/achievements/improvement.mp3',
};

// ============================================
//  SONIDOS DE JUEGOS Y ENTRETENIMIENTO
// ============================================

export const GAME_SOUNDS = {
  MATCH_START: '/assets/sounds/games/match-start.mp3',
  MATCH_END: '/assets/sounds/games/match-end.mp3',
  WIN: '/assets/sounds/games/win.mp3',
  LOSE: '/assets/sounds/games/lose.mp3',
  DRAW: '/assets/sounds/games/draw.mp3',
  LEVEL_COMPLETE: '/assets/sounds/games/level-complete.mp3',
  BONUS: '/assets/sounds/games/bonus.mp3',
  POWER_UP: '/assets/sounds/games/power-up.mp3',
  COMBO: '/assets/sounds/games/combo.mp3',
  HIGH_SCORE: '/assets/sounds/games/high-score.mp3',
};

// ============================================
//  SONIDOS AMBIENTALES
// ============================================

export const AMBIENT_SOUNDS = {
  NATURE: '/assets/sounds/ambient/nature.mp3',
  RAIN: '/assets/sounds/ambient/rain.mp3',
  OCEAN: '/assets/sounds/ambient/ocean.mp3',
  FOREST: '/assets/sounds/ambient/forest.mp3',
  MOUNTAINS: '/assets/sounds/ambient/mountains.mp3',
  CITY: '/assets/sounds/ambient/city.mp3',
  COFFEE_SHOP: '/assets/sounds/ambient/coffee-shop.mp3',
  LIBRARY: '/assets/sounds/ambient/library.mp3',
  FIREPLACE: '/assets/sounds/ambient/fireplace.mp3',
  WHITE_NOISE: '/assets/sounds/ambient/white-noise.mp3',
};

// ============================================
//  SONIDOS DE MSICA DE FONDO
// ============================================

export const BACKGROUND_MUSIC = {
  FOCUS: '/assets/sounds/music/focus.mp3',
  RELAX: '/assets/sounds/music/relax.mp3',
  MOTIVATION: '/assets/sounds/music/motivation.mp3',
  STUDY: '/assets/sounds/music/study.mp3',
  WORKOUT: '/assets/sounds/music/workout.mp3',
  MEDITATION: '/assets/sounds/music/meditation.mp3',
  CREATIVE: '/assets/sounds/music/creative.mp3',
  PRODUCTIVE: '/assets/sounds/music/productive.mp3',
  CALM: '/assets/sounds/music/calm.mp3',
  ENERGIZING: '/assets/sounds/music/energizing.mp3',
};

// ============================================
//  CONFIGURACIN DE AUDIO
// ============================================

export const AUDIO_CONFIG = {
  // Vol煤menes por defecto
  DEFAULT_VOLUMES: {
    ACTIONS: 0.7,
    NOTIFICATIONS: 0.8,
    NAVIGATION: 0.5,
    HEALTH: 0.6,
    EDUCATION: 0.7,
    ACHIEVEMENTS: 0.9,
    GAMES: 0.8,
    AMBIENT: 0.3,
    MUSIC: 0.4,
  },

  // Duraciones de sonidos
  DURATIONS: {
    SHORT: 0.2,    // 200ms
    MEDIUM: 0.5,   // 500ms
    LONG: 1.0,     // 1s
    EXTRA_LONG: 2.0, // 2s
  },

  // Configuraci贸n de repetici贸n
  REPEAT: {
    NONE: 0,
    ONCE: 1,
    LOOP: -1,
    TWICE: 2,
    THRICE: 3,
  },

  // Efectos de audio
  EFFECTS: {
    FADE_IN: 'fade-in',
    FADE_OUT: 'fade-out',
    ECHO: 'echo',
    REVERB: 'reverb',
    PITCH_SHIFT: 'pitch-shift',
    SPEED_CHANGE: 'speed-change',
  },
};

// ============================================
//  CLASE GESTORA DE AUDIO
// ============================================

export class AudioManager {
  private audioContext: AudioContext | null = null;
  private sounds: Map<string, HTMLAudioElement> = new Map();
  private volumes: Map<string, number> = new Map();
  private enabled: boolean = true;

  constructor() {
    this.initializeAudio();
  }

  private async initializeAudio() {
    try {
      this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();
      this.loadDefaultVolumes();
    } catch (error) {
      console.warn('Audio context not supported:', error);
    }
  }

  private loadDefaultVolumes() {
    Object.entries(AUDIO_CONFIG.DEFAULT_VOLUMES).forEach(([category, volume]) => {
      this.volumes.set(category.toLowerCase(), volume);
    });
  }

  /**
   * Reproduce un sonido
   */
  async play(soundPath: string, options: {
    volume?: number;
    loop?: boolean;
    category?: string;
  } = {}): Promise<void> {
    if (!this.enabled) return;

    try {
      const audio = new Audio(soundPath);
      const volume = options.volume ?? this.volumes.get(options.category || 'actions') ?? 0.7;
      audio.volume = volume;

      if (options.loop) {
        audio.loop = true;
      }

      await audio.play();
      this.sounds.set(soundPath, audio);

      // Limpiar cuando termine
      audio.onended = () => {
        this.sounds.delete(soundPath);
      };

    } catch (error) {
      console.warn('Error playing sound:', error);
    }
  }

  /**
   * Detiene un sonido
   */
  stop(soundPath: string): void {
    const audio = this.sounds.get(soundPath);
    if (audio) {
      audio.pause();
      audio.currentTime = 0;
      this.sounds.delete(soundPath);
    }
  }

  /**
   * Pausa todos los sonidos
   */
  pauseAll(): void {
    this.sounds.forEach(audio => audio.pause());
  }

  /**
   * Reanuda todos los sonidos
   */
  resumeAll(): void {
    this.sounds.forEach(audio => audio.play());
  }

  /**
   * Establece el volumen de una categor铆a
   */
  setCategoryVolume(category: string, volume: number): void {
    this.volumes.set(category.toLowerCase(), Math.max(0, Math.min(1, volume)));
  }

  /**
   * Habilita/deshabilita el audio
   */
  setEnabled(enabled: boolean): void {
    this.enabled = enabled;
    if (!enabled) {
      this.pauseAll();
    }
  }

  /**
   * Precarga sonidos cr铆ticos
   */
  async preloadCriticalSounds(): Promise<void> {
    const criticalSounds = [
      ACTION_SOUNDS.SUCCESS,
      ACTION_SOUNDS.ERROR,
      NOTIFICATION_SOUNDS.REMINDER,
    ];

    await Promise.all(
      criticalSounds.map(sound => this.preloadSound(sound))
    );
  }

  private async preloadSound(soundPath: string): Promise<void> {
    return new Promise((resolve, reject) => {
      const audio = new Audio();
      audio.preload = 'auto';
      audio.oncanplaythrough = () => resolve();
      audio.onerror = reject;
      audio.src = soundPath;
    });
  }
}

// ============================================
//  EXPORTACIN PRINCIPAL
// ============================================

export const SOUNDS = {
  ACTION_SOUNDS,
  NOTIFICATION_SOUNDS,
  NAVIGATION_SOUNDS,
  HEALTH_SOUNDS,
  EDUCATION_SOUNDS,
  ACHIEVEMENT_SOUNDS,
  GAME_SOUNDS,
  AMBIENT_SOUNDS,
  BACKGROUND_MUSIC,
  AUDIO_CONFIG,
  AudioManager,
};

// ============================================
//  FUNCIONES UTILITARIAS
// ============================================

/**
 * Instancia global del gestor de audio
 */
export const audioManager = new AudioManager();

/**
 * Reproduce un sonido de acci贸n
 */
export const playActionSound = (action: keyof typeof ACTION_SOUNDS) => {
  audioManager.play(ACTION_SOUNDS[action], { category: 'actions' });
};

/**
 * Reproduce un sonido de notificaci贸n
 */
export const playNotificationSound = (type: keyof typeof NOTIFICATION_SOUNDS) => {
  audioManager.play(NOTIFICATION_SOUNDS[type], { category: 'notifications' });
};

/**
 * Reproduce un sonido de navegaci贸n
 */
export const playNavigationSound = (action: keyof typeof NAVIGATION_SOUNDS) => {
  audioManager.play(NAVIGATION_SOUNDS[action], { category: 'navigation' });
};

/**
 * Reproduce un sonido de logro
 */
export const playAchievementSound = (achievement: keyof typeof ACHIEVEMENT_SOUNDS) => {
  audioManager.play(ACHIEVEMENT_SOUNDS[achievement], { category: 'achievements' });
};
